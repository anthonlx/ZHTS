/* 2017-12-12 09:24:47 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683】 */
mars3d.widget.bindClass(mars3d.BaseWidget.extend({options:{view:{type:"window",url:"view.html",windowOptions:{width:240,height:100}}},drawControl:null,particles:null,create:function(){this.particles=[];var i=this;this.drawControl=new mars3d.Draw({viewer:this.viewer,hasEdit:!1,onStopDrawing:function(e){i.createParticle(e)}})},viewWindow:null,winCreateOK:function(i,e){this.viewWindow=e},activate:function(){},disable:function(){},createFire:function(i){this.drawControl.startDraw({type:"billboard",style:{scale:.6,image:this.path+"img/marker.png"}})},createParticle:function(i){var e=(new Cesium.Cartesian3(0,0,0),mars3d.drawing.utils.getPositionsWithHeight(i.position._value,2));this.viewer.entities.remove(i);var t=20,a=Cesium.Transforms.eastNorthUpToFixedFrame(e),r=function(i,e){var a=i.position,r=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(a,r),Cesium.Cartesian3.multiplyByScalar(r,t*e,r),i.velocity=Cesium.Cartesian3.add(i.velocity,r,i.velocity)},m=this.viewer.scene.primitives.add(new Cesium.ParticleSystem({image:this.path+"/img/fire.png",startColor:Cesium.Color.RED.withAlpha(.7),endColor:Cesium.Color.YELLOW.withAlpha(.3),startScale:1,endScale:4,maximumLife:1,minimumLife:1,minimumSpeed:5,maximumSpeed:5,minimumWidth:20,minimumHeight:20,maximumWidth:20,maximumHeight:20,rate:5,bursts:[new Cesium.ParticleBurst({time:5,minimum:300,maximum:500}),new Cesium.ParticleBurst({time:10,minimum:50,maximum:100}),new Cesium.ParticleBurst({time:15,minimum:200,maximum:300})],lifeTime:16,emitter:new Cesium.CircleEmitter(.5),modelMatrix:a,emitterModelMatrix:this.computeEmitterModelMatrix(),forces:[r]}));this.particles.push(m)},computeEmitterModelMatrix:function(){var i=Cesium.HeadingPitchRoll.fromDegrees(0,0,-100,new Cesium.HeadingPitchRoll),e=new Cesium.TranslationRotationScale;return e.translation=Cesium.Cartesian3.fromElements(2.5,4,1,new Cesium.Cartesian3),e.rotation=Cesium.Quaternion.fromHeadingPitchRoll(i,new Cesium.Quaternion),Cesium.Matrix4.fromTranslationRotationScale(e,new Cesium.Matrix4)},clear:function(){for(var i=0;i<this.particles.length;i++)this.viewer.scene.primitives.remove(this.particles[i]);this.particles=[]}}));