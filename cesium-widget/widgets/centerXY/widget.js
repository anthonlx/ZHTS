/* 2018-1-11 11:50:17 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683】 */
mars3d.widget.bindClass(mars3d.BaseWidget.extend({options:{view:{type:"window",url:"view.html",windowOptions:{width:210,height:210}}},viewWindow:null,winCreateOK:function(e,i){this.viewWindow=i},markerXY:null,handler:null,activate:function(){var e=this;this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction(function(i){var t=mars3d.latlng.getCurrentMousePosition(e.viewer.scene,i.position);if(t){var r=Cesium.Cartographic.fromCartesian(t),n=Number(Cesium.Math.toDegrees(r.longitude).toFixed(6)),a=Number(Cesium.Math.toDegrees(r.latitude).toFixed(6)),s=Number(r.height.toFixed(1)),o={x:n,y:a,z:s};e.updateMarker(o);var m=mars3d.map.point2wgs({x:n,y:a});n=m.x,a=m.y,e.viewWindow.showLatlng({x:n,y:a,z:s})}},Cesium.ScreenSpaceEventType.LEFT_CLICK)},disable:function(){this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.destroy(),this.markerXY&&(this.viewer.entities.remove(this.markerXY),this.markerXY=null)},getMapCenter:function(){var e=mars3d.latlng.getCenter(this.viewer,!0);return e},centerAt:function(e,i){var t=mars3d.map.point2map(e);this.updateMarker(t,i)},updateMarker:function(e,i){var t=Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z||0);null==this.markerXY?this.markerXY=this.viewer.entities.add({name:"坐标拾取",position:t,billboard:{image:this.path+"img/marker.png",horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,scale:.6}}):this.markerXY.position=t,i&&mars3d.map.centerAt({x:e.x,y:e.y})}}));