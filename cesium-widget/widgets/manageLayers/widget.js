/* 2018-1-18 16:31:25 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683】 */
mars3d.widget.bindClass(mars3d.BaseWidget.extend({map:null,options:{view:{type:"window",url:"view.html",windowOptions:{width:250,height:500}}},hasManagerBaseMaps:!0,create:function(){},viewWindow:null,winCreateOK:function(e,i){this.viewWindow=i},activate:function(){},disable:function(){},_tempIdx:1,arrIdx:[],getNextId:function(){for(;this.arrIdx.indexOf(this._tempIdx)!=-1;)this._tempIdx++;return this.arrIdx.push(this._tempIdx),this._tempIdx},_layers:null,addOverlay:function(e){e.name||(e.name="未命名"),e.id||(e.id=this.getNextId()),e.pid||(e.pid=-1);var i=Number(e.order);isNaN(i)&&(i=this._layers.length+1),e.order=i,e._key=this._layers.length+"_"+e.id+"_"+e.name,this._layers.push(e),this.isActivate&&this.viewWindow&&this.viewWindow.addNode(e)},removeLayer:function(e){for(var i=0;i<this._layers.length;i++){var t=this._layers[i];if(t.name==e){this._layers.splice(i,1),this.isActivate&&this.viewWindow&&this.viewWindow.removeNode(t);break}}},getLayers:function(){if(null==this._layers){var e=[],i=this.hasManagerBaseMaps?this.viewer.gisdata.config.basemaps:[],t=this.viewer.gisdata.config.operationallayers;this._tempIdx=1,this.arrIdx=[];for(var a=0;a<i.length;a++){var r=i[a];r.id&&this.arrIdx.push(r.id)}for(var a=0;a<t.length;a++){var r=t[a];r.id&&this.arrIdx.push(r.id)}for(var a=0;a<i.length;a++){var r=i[a];if(r.name||(r.name="未命名"),r.id||(r.id=this.getNextId()),r.pid||(r.pid=-1),e.push(r),"group"==r.type&&r.layers)for(var s=0;s<r.layers.length;s++){var n=r.layers[s];n.pid=r.id,n.id=this.getNextId(),n.name||(n.name=r.name+"-"+(s+1)),n._parent=r,e.push(n)}}for(var a=0;a<t.length;a++){var r=t[a];r.name||(r.name="未命名"),r.id||(r.id=this.getNextId()),r.pid||(r.pid=-1),e.push(r)}for(var a=0;a<e.length;a++){var r=e[a],d=Number(r.order);isNaN(d)&&(d=a),r.order=d,r._key=a+"_"+r.id+"_"+r.name,null!=r._layer&&this.udpateLayerZIndex(r._layer,d)}this._layers=e}return this._layers},centerAt:function(e){e.centerAt()},getLayerVisible:function(e){return e.getVisible()},updateLayerVisible:function(e,i){e.setVisible(i),i&&e.centerAt()},udpateLayerOpacity:function(e,i){e.setOpacity(i)},udpateLayerZIndex:function(e,i){e.setZIndex(i)}}));