/* 2018-1-12 10:53:04 | 版权所有 合肥火星科技有限公司 http://www.marsgis.cn  【联系我们QQ：516584683】 */
mars3d.widget.bindClass(mars3d.BaseWidget.extend({map:null,options:{view:{type:"window",url:"view.html",windowOptions:{width:650,height:110}}},viewWindow:null,winCreateOK:function(e,i){this.viewWindow=i},activate:function(){viewer.scene.camera.moveEnd.addEventListener(this.camera_moveEndHandler,this)},disable:function(){viewer.scene.camera.moveEnd.removeEventListener(this.camera_moveEndHandler,this)},camera_moveEndHandler:function(){var e=this.getUrl();console.log(e),this.viewWindow&&this.viewWindow.updateUrl(e)},getUrl:function(){var e=mars3d.latlng.getCameraView(this.viewer,!0),i=window.location.href;i.lastIndexOf("#")!=-1&&(i=i.replace(window.location.hash,"").replace("#",""));var n=i.lastIndexOf("?");n!=-1&&(i=i.substring(0,n));var t=i+"?x="+e.x+"&y="+e.y+"&z="+e.z+"&heading="+e.heading+"&pitch="+e.pitch+"&roll="+e.roll,a=haoutil.system.getRequest();for(var r in a)"x"!=r&&"y"!=r&&"z"!=r&&"heading"!=r&&"pitch"!=r&&"roll"!=r&&(t+="&"+r+"="+a[r]);return t}}));